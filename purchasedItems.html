<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Purchased Products</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
        integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <link
        href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">

    <style>
     .container {
            max-width: 960px;
           
            padding: 30px;
            background-color: white;
            border-radius: 10px;
            /* More rounded corners */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            /* Stronger, softer shadow */
            font-family: 'Poppins', sans-serif; /* Apply Poppins font */
        }

        .container h2 {
            text-align: center;
            color: #007bff;
            /* Primary blue color */
            margin-bottom: 30px;
            font-size: 2.2rem;
            font-weight: 700;
            position: relative;
        }

        .container h2::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 3px;
            background-color: #007bff;
            border-radius: 2px;
        }

        .pitems {
            display: grid;
            /* Use CSS Grid for better layout */
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            /* Responsive grid */
            gap: 25px;
            /* More space between items */
            justify-content: center;
        }

        .products {
            background-color: #ffffff;
            /* White background for product cards */
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            /* Card-like shadow */
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid #eee;
            /* Subtle border */
        }

        .products:hover {
            transform: translateY(-5px);
            /* Lift effect on hover */
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            /* Stronger shadow on hover */
        }

        .products img {
            max-width: 100%;
            /* Ensure image fits within card */
            height: 200px;
            object-fit: contain;
            /* Ensures the image is scaled without cropping */
            padding: 10px;
            border-radius: 8px;
            background-color: #f8f9fa;
            /* Light background for image area */
            margin-bottom: 15px;
        }

        .products h3 {
            margin-top: 10px;
            font-size: 1.4rem;
            color: #333;
            font-weight: 600;
            word-wrap: break-word;
            /* Prevents long names from overflowing */
        }

        .no-items {
            text-align: center;
            font-size: 1.3rem;
            color: #6c757d;
            /* Muted gray color */
            padding: 40px;
            background-color: #e9ecef;
            border-radius: 8px;
            margin-top: 30px;
        }

    </style>
</head>

<body>
    <div class="header">
        <div class="logo">
            <i class="fa-solid fa-shop"></i>
            <h2>MyStore</h2>
        </div>
        <div class="menu">
            <i class="fa-solid fa-bars" onclick="menuShow()"></i>
        </div>
        <div class="links nav">
            <ul>
                <li><a href="index.html"><i class="fas fa-home"></i> Home</a></li>
                <li><a href="#" id="product-link"><i class="fas fa-box-open"></i> Products</a></li>
                <li><a href="cart.html"><i class="fas fa-shopping-cart"></i> Cart Items</a></li>
                <li><a href='purchasedItems.html' style="color: #3498db;" class="text-decoration-none"><i
                            class="fas fa-truck-fast"></i> Purchased Items</a></li>


            </ul>
        </div>
    </div>
    <div class="container">

        <h2>Your Purchased Items:</h2>
        <div class="pitems">
            </div>
    </div>
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section about">
                <h3>About MyStore</h3>
                <p>Your one-stop shop for the latest and greatest products. We strive for quality and customer
                    satisfaction.</p>
            </div>
            <div class="footer-section links">
                <h3>Quick Links</h3>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="#" id="footer-product-link">Products</a></li>
                    <li><a href="cart.html">Cart</a></li>
                    <li><a href='purchasedItems.html' class="text-decoration-none">Purchased Items</a></li>
                </ul>
            </div>
            <div class="footer-section contact">
                <h3>Contact Us</h3>
                <p><i class="fas fa-map-marker-alt"></i> 123 E-commerce St, Online City, World</p>
                <p><i class="fas fa-phone"></i> +123 456 7890</p>
                <p><i class="fas fa-envelope"></i> info@mystore.com</p>
            </div>
            <div class="footer-section social">
                <h3>Follow Us</h3>
                <div class="social-icons">
                    <a href="https://github.com/TeamMembers6" target="_blank" aria-label="GitHub"><i class="fab fa-github"></i></a>
                    <a href="https://www.linkedin.com/in/yaswanth-thalluru/" target="_blank" aria-label="LinkedIn"><i
                            class="fab fa-linkedin-in"></i></a>
                    <a href="https://mobile.x.com/imYashBhai" target="_blank" aria-label="X (formerly Twitter)"><i
                            class="fab fa-x-twitter"></i></a>
                    <a href="mailto:yeswantthalluru@gmail.com" target="_blank" aria-label="E-Mail"><i
                            class="fas fa-envelope"></i></a>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            &copy; 2025 MyStore. All rights reserved.
        </div>
    </footer>
    <script>
        function menuShow() {
            let popup = document.querySelector('.links');
            popup.classList.toggle('sidenav');
            let links = document.querySelector('.links');
            if (popup.classList.contains('sidenav')) {
                links.style.display = 'block';

            }
            else
                links.style.display = 'none';
        }

        document.addEventListener("DOMContentLoaded", function () {
            // Dynamically set product link with random ID between 1 and 20
            const randomProductId = Math.floor(Math.random() * 20) + 1;
            document.getElementById('product-link').href = `product.html?id=${randomProductId}`;
            document.getElementById('footer-product-link').href = `product.html?id=${randomProductId}`;


            const token = localStorage.getItem('auth'); // Assuming the token is stored in localStorage

            // Check if token exists
            if (!token) {
                window.location.href = 'login.html'; // Redirect to login if no token is found
                return;
            }

            fetch('https://mini-e-commerce-xrfg.onrender.com/purchased', {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${token}`, // Attach the token to the request headers
                }
            })
                .then(res => {
                    if (!res.ok) {
                        if (res.status === 401 || res.status === 403) {
                            localStorage.removeItem('auth');
                            window.location.href = 'login.html';
                        }
                        throw new Error(`HTTP error! status: ${res.status}`);
                    }
                    return res.json();
                })
                .then(data => {
                    const itemsHtml = document.querySelector('.pitems');
                    if (data.length > 0) {
                        // Display purchased items
                        itemsHtml.innerHTML = data.map(item =>
                            `
                        <div class='products'>
                            <img src="${item.image}" alt='${item.purchasedItem} Image' />
                            <h3>${item.purchasedItem}</h3>
                        </div>
                        `
                        ).join('');
                    } else {
                        itemsHtml.innerHTML = "<p class='no-items'>No purchased items found. Start shopping to see your purchases here!</p>";
                    }
                })
                .catch(err => {
                    console.error("Error fetching purchased items:", err);
                    document.querySelector('.pitems').innerHTML = "<p class='no-items'>Error loading purchased items. Please try again later.</p>";
                });
        });
    </script>
</body>

</html>
